# Minotaur Grammar Generation System

The Minotaur Grammar Generation System is a comprehensive framework for automatically generating grammar definitions from source code examples. It leverages advanced pattern recognition, error-driven refinement, and context-aware enhancement techniques to create high-quality grammar files that follow the Grammar File Creation Guide standards.

## Features

- **Automatic Token Pattern Recognition**: Identifies keywords, operators, literals, and structural elements
- **Syntax Structure Discovery**: Analyzes expression precedence, statement types, and control flow patterns
- **Error-Driven Grammar Refinement**: Uses parsing errors to iteratively improve grammar accuracy
- **Context-Aware Enhancement**: Applies language-specific optimizations based on context
- **Quality Validation**: Comprehensive validation and quality metrics generation
- **Grammar File Creation Guide Compliance**: Outputs standard-compliant grammar files
- **Interactive CLI Interface**: Command-line tools for grammar generation and validation

## Architecture

### Core Components

1. **Language Analysis Engine**
   - `TokenPatternAnalyzer`: Identifies token patterns from source code
   - `SyntaxStructureAnalyzer`: Discovers syntax patterns and production rules

2. **Error-Driven Grammar Refinement**
   - `ParseErrorAnalyzer`: Analyzes parsing errors to suggest improvements
   - Iterative grammar improvement based on validation feedback

3. **Interactive Grammar Generator**
   - `GrammarGenerator`: Main orchestrator for the generation process
   - Real-time progress reporting and user feedback

4. **Validation and Testing Framework**
   - `GrammarValidator`: Validates generated grammars for correctness and quality
   - Quality metrics and performance analysis

## Usage

### Basic Usage

```csharp
using GolemCognitiveGraph.GrammarGeneration;
using GolemCognitiveGraph.GrammarGeneration.Models;

// Initialize the grammar generator
var generator = new GrammarGenerator();

// Define source files and context
var sourceFiles = new[] { "sample1.lang", "sample2.lang" };
var context = new LanguageContext
{
    HasNestedScopes = true,
    HasTypeSystem = true,
    HasComments = true
};

// Generate grammar
var grammar = await generator.GenerateGrammarAsync(
    "MyLanguage",
    sourceFiles,
    context);

// Save to file
await generator.SaveGrammarAsync(grammar, "MyLanguage.grammar");
```

### Command Line Interface

```bash
# Generate grammar from source files
minotaur-grammar generate --language MyLang --output mylang.grammar src/*.mylang

# Validate existing grammar
minotaur-grammar validate mylang.grammar src/*.mylang

# Show help
minotaur-grammar help generate
```

### Advanced Features

#### Context-Aware Generation

```csharp
var context = new LanguageContext
{
    HasNestedScopes = true,     // Language supports nested scopes
    HasTypeSystem = true,       // Language has a type system
    HasMacroSystem = false,     // No macro preprocessing
    HasComments = true,         // Language supports comments
    HasStringLiterals = true,   // String literals supported
    HasNumericLiterals = true,  // Numeric literals supported
    FileExtensions = new[] { ".mylang" },
    DefaultEncoding = "UTF-8"
};
```

#### Progress Tracking

```csharp
var progress = new Progress<GrammarGenerationProgress>(p =>
{
    Console.WriteLine($"{p.Stage}... {p.Progress}%");
});

var grammar = await generator.GenerateGrammarAsync(
    languageName, sourceFiles, context, progress);
```

#### Quality Validation

```csharp
var validator = new GrammarValidator();
var validationResult = await validator.ValidateGrammarAsync(grammar, sourceFiles);

if (validationResult.IsValid)
{
    Console.WriteLine("Grammar is valid!");
    Console.WriteLine($"Quality Score: {validationResult.QualityReport.LanguageFeatureCoverage:P}");
}
else
{
    foreach (var error in validationResult.Errors)
    {
        Console.WriteLine($"Error: {error}");
    }
}
```

## Generated Grammar Format

The system generates grammar files that comply with the Grammar File Creation Guide:

```
Grammar: MyLanguage
TokenSplitter: Space
FormatType: EBNF

/*
 * MyLanguage Grammar Definition
 * Generated by Minotaur Grammar Generator
 * Created: 2024-01-01 12:00:00 UTC
 * Version: 1.0.0
 */

Keywords: if, else, while, for, function, var, return

<program> ::= <declaration_list>

<declaration_list> ::= <declaration>
                    | <declaration_list> <declaration>

<declaration> ::= <function_definition>
               | <variable_declaration>

<function_definition> ::= <FUNCTION> <IDENTIFIER> <LPAREN> <parameter_list>? <RPAREN> <block>

<variable_declaration> ::= <VAR> <IDENTIFIER> <ASSIGN>? <expression>? <SEMICOLON>

// Token definitions
<IDENTIFIER> ::= /[a-zA-Z_][a-zA-Z0-9_]*/
<NUMBER_LITERAL> ::= /\d+(\.\d+)?/
<STRING_LITERAL> ::= /"[^"]*"/
<WHITESPACE> ::= /[ \t\r\n]+/ => { skip }
```

## Integration with Minotaur Features

### CognitiveGraph Integration

The grammar generation system integrates with Minotaur's CognitiveGraph capabilities to:

- Create semantic models for language constructs
- Establish semantic relationships between grammar elements
- Add context-sensitive parsing hints
- Enable advanced code analysis and transformation

### ContextAware Editor Integration

Leverages the ContextAwareEditor to:

- Generate context-sensitive grammar rules
- Apply scope-aware enhancements
- Support type-aware grammar generation
- Handle macro expansion rules

## Quality Metrics

The system provides comprehensive quality metrics:

- **Language Feature Coverage**: Percentage of language features covered
- **Token Coverage**: Completeness of token pattern recognition
- **Parse Accuracy**: Accuracy of parsing against source files
- **Semantic Accuracy**: Correctness of semantic analysis
- **Performance Metrics**: Parse speed and memory usage
- **Grammar Quality**: Complexity, readability, and modularity scores

## Examples

### Simple Language Grammar Generation

```csharp
// Run the complete example
await GrammarGenerationExample.RunAsync();
```

This will:
1. Create sample source files
2. Generate a grammar for "SimpleScript" language
3. Display the generated grammar file
4. Show quality statistics and metrics

### Custom Language Features

```csharp
// For languages with specific features
var context = new LanguageContext
{
    HasNestedScopes = true,
    HasTypeSystem = true,
    HasMacroSystem = true  // Enable macro support
};

var grammar = await generator.GenerateGrammarAsync(
    "MacroLang", sourceFiles, context);
```

## Technical Implementation

### Token Pattern Recognition

The `TokenPatternAnalyzer` uses sophisticated pattern recognition to identify:

- **Keywords**: Frequent, context-specific identifiers
- **Operators**: Mathematical and logical operators
- **Literals**: String, numeric, and boolean literals
- **Delimiters**: Structural elements like brackets and semicolons
- **Comments**: Single-line and multi-line comment patterns

### Syntax Structure Analysis

The `SyntaxStructureAnalyzer` discovers:

- **Expression Hierarchies**: Operator precedence and associativity
- **Statement Patterns**: Control flow and declaration structures
- **Function Definitions**: Parameter lists and body structures
- **Scoping Rules**: Block structure and nesting patterns

### Error-Driven Refinement

The system uses parsing errors to improve grammar quality:

1. **Error Categorization**: Groups errors by type and frequency
2. **Pattern Analysis**: Identifies missing or incorrect rules
3. **Refinement Suggestions**: Proposes specific grammar improvements
4. **Iterative Improvement**: Applies refinements and re-validates

### Performance Optimization

- **Incremental Analysis**: Processes files incrementally for large codebases
- **Pattern Caching**: Caches frequently used patterns
- **Parallel Processing**: Analyzes multiple files concurrently
- **Memory Efficient**: Uses streaming for large files

## Future Enhancements

### StepLexer/StepParser Integration

The system is designed to integrate with extended StepLexer and StepParser features:

- **Interactive Tokenization**: Real-time token pattern validation
- **Grammar Rule Testing**: Individual rule testing and validation
- **Error Recovery**: Advanced error recovery and suggestion
- **Incremental Parsing**: Support for incremental grammar updates

### Advanced Features

- **Multi-Language Support**: Generate grammars for embedded languages
- **Grammar Composition**: Combine multiple grammar fragments
- **Semantic Enhancement**: Add semantic actions to grammar rules
- **Performance Profiling**: Detailed grammar performance analysis

## Contributing

The grammar generation system is part of the Minotaur project and follows the same contribution guidelines. Key areas for contribution:

1. **Pattern Recognition**: Improve token and syntax pattern detection
2. **Language Support**: Add support for specific language features
3. **Quality Metrics**: Enhance grammar quality assessment
4. **Performance**: Optimize generation speed and memory usage
5. **Testing**: Add comprehensive test coverage

## License

This component is part of Minotaur and is licensed under the GNU Affero General Public License v3.0.